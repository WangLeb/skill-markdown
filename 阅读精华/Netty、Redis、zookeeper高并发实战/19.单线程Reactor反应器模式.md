###  EchoServerReactor

~~~java

        Selector selector = Selector.open();
        ServerSocketChannel serverSocket = ServerSocketChannel.open();

        EchoServerReactor() throws Exception{
            serverSocket.configureBlocking(false);
            serverSocket.socket().bind(new InetSocketAddress(7777));
            SelectionKey selectionKey = serverSocket.register(selector, SelectionKey.OP_ACCEPT);
            selectionKey.attach(new AcceptorHandler());
        }

        @Override
        public void run() {
           try {
               while (!Thread.interrupted()){
                   selector.select();
                   Set<SelectionKey> selectionKeys1 = selector.selectedKeys();
                   Iterator<SelectionKey> selectionKeys = selectionKeys1.iterator();
                   while (selectionKeys.hasNext()){
                       SelectionKey selectionKey = selectionKeys.next();
                       dispatch(selectionKey);
                   }
                   selectionKeys1.clear();
               }
           }catch (Exception e){
                e.printStackTrace();
           }
        }

        void dispatch(SelectionKey selectionKey){
            if(selectionKey.attachment() != null){
                Runnable handler = (Runnable)selectionKey.attachment();
                handler.run();
            }
        }
~~~

###  AcceptorHandler

~~~java
		class AcceptorHandler implements Runnable{
            @Override
            public void run() {
                try {
                    SocketChannel socketChannel = serverSocket.accept();
                    if(socketChannel != null){
                        new EchoHandler(selector,socketChannel);
                    }
                }catch (Exception e){

                }
            }
        }

~~~

###  EchoHandler

~~~java
	private final SocketChannel socketChannel;

    private final ByteBuffer byteBuffer = ByteBuffer.allocate(1024);

    private final SelectionKey selectionKey;


    private final static int WRITE = SelectionKey.OP_WRITE;

    private final static int READ = SelectionKey.OP_READ;

    private int state = READ;


    EchoHandler(Selector selector, SocketChannel socketChannel) throws Exception{
        this.socketChannel= socketChannel;
        socketChannel.configureBlocking(false);
        this.selectionKey = socketChannel.register(selector, SelectionKey.OP_READ);
        selectionKey.attach(this);
        selector.wakeup();
    }

    @Override
    public void run() {
        try {
            if(this.state == READ){
                while (this.socketChannel.read(this.byteBuffer) > 0 ){
                    selectionKey.interestOps(WRITE);
                    this.state = WRITE;
                    this.byteBuffer.flip();
                }
            }else if(this.state == WRITE){
                System.out.println("服务端接收数据>>"+new String(byteBuffer.array(),0,byteBuffer.limit()));
                this.socketChannel.write(this.byteBuffer);
                this.byteBuffer.clear();
                selectionKey.interestOps(READ);
                this.state = READ;
            }
        }catch (Exception e){
            e.printStackTrace();
        }
    }
~~~

###  启动

~~~java
 	 try {
           EchoServerReactor echoServerReactor = new EchoServerReactor();
           Thread thread = new Thread(echoServerReactor);
           thread.start();
       }catch (Exception e){
            e.printStackTrace();
       }
~~~

